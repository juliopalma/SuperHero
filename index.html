<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <title>Prueba de los SuperHeroes</title>

    <!-- Diseñador de la página -->
    <meta name="author" content="Julio Andrés Palma Quezada" />
</head>

<body>
    <!-- CDN de JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <!-- JQUERY -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>
    <div style="color:dimgrey;font-size:9px;font-family: Verdana, Arial, Helvetica, sans-serif;text-decoration:none;"></div>

    <!-- navbar -->
    <nav class="navbar navbar-expand-lg p-3 mb-2 bg-info navbar-dark bg-dark text-white " id="BarraHTML">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="assets/img/favicon.ico" alt="Logo superHeroe" class="ml3 ms-4" data-toggle="tooltip" data-placement="right" title="Ir al Inicio de la pagina">
                <span class="text-white m-1" data-toggle="tooltip" data-placement="right" title="Ir al Inicio de la pagina">SuperHero</span>
            </a>
        </div>
    </nav>

    <div id="container">
        <!-- centrar la imagen -->
        <div class="row">
            <div class="col-3"></div>
            <div class="col-6 text-center">
                <img src="assets/img/sh1.jpg" alt="Logo superHeroe" data-toggle="tooltip" data-placement="right" title="Super Héroes">
            </div>
            <div class="col-3"></div>
        </div>

        <!-- Formulario -->
        <div class="row">
            <div class="col-3"></div>
            <div class="col-6">
                <form>
                    <div class="col-12">
                        <h2>Encuentra tu SuperHero</h2>
                        <label class="form-label">Ingresa el número del SuperHero a buscar</label>
                        <p><input type="number" min="1" max="732" class="form-control" id="inputSuperHero" required></p>
                        <p><button type="submit" class="btn btn-primary clickBuscar">Buscar</button></p>
                    </div>
                </form>
            </div>
            <div class="col-3"></div>
        </div>
        <!-- SuperHeroe encontrado -->
        <div class="row">
            <div class="col-2"></div>
            <div class="col-4">
                <h2 id="encontrado"></h2>
            </div>
            <div class="col-6"></div>
        </div>

        <!-- Tarjeta de superHeroe-->
        <div class="card">
            <div class="row no-gutters">

                <!-- Imagen de tarjeta -->
                <div class="col-2" id="cardImage">
                    <img src="" class="card-img" id="imagenSuperHeroe" alt="Super Héroe">
                </div>
                <!-- Contenido de la informacion del superHeroe -->
                <div class="col-4" id="cardInfo">
                    <div class="card-body ">

                        <p id="nombre">Nombre: <span id="spanNombre"></span></p>
                        <p id="conexiones">Conexiones: <span id="spanConexiones"></span></p>
                        <p id="publicado">Publicado por: <span id="spanPublicacion"></span></p>
                        <hr>
                        <p id="ocupacion">Ocupación: <span id="spanOcupacion"></span></p>
                        <hr>
                        <p id="primeraAparición">Primera Aparición: <span id="spanPrimeraAparicion"></span></p>
                        <hr>
                        <p id="altura">Altura: <span id="spanAltura"></span></p>
                        <hr>
                        <p id="peso">Peso: <span id="spanPeso"></span></p>
                        <hr>
                        <p id="alianzas">Apodos: <span id="spanAlianzas"></span></p>

                    </div>
                </div>
                <!-- Grafico -->
                <div class="col-6">
                    <div id="" class="creaGrafico" style="height: 370px; width: 100%;"></div>
                    <script>
                        let options = {

                            title: {
                                text: `Estadísticas de Poder para`

                            },
                            data: [{
                                type: "pie",
                                startAngle: 45,
                                showInLegend: "true",
                                legendText: "{label}",
                                indexLabel: "{label} ({y})",
                                yValueFormatString: "#,##0.#" % "",
                                dataPoints: [{
                                    label: "Organic",
                                    y: 36
                                }, {
                                    label: "Email Marketing",
                                    y: 31
                                }, {
                                    label: "Referrals",
                                    y: 7
                                }, {
                                    label: "Twitter",
                                    y: 7
                                }, {
                                    label: "Facebook",
                                    y: 6
                                }, {
                                    label: "Google",
                                    y: 220
                                }, {
                                    label: "Others",
                                    y: 32
                                }]
                            }]
                        };
                        $("#chartContainer").CanvasJSChart(options);
                    </script>
                </div>
                <div class="text-center">
                    <div class="text-center">
                        <h1 id="nombrePokemon"></h1>
                    </div>
                    <!-- Validaciones para mostrar u ocultar la tarjeta y el gráfico -->
                    <script>
                        $("#cardImage").hide();
                        $("#cardInfo").hide();

                        let numeroDelSuperHero = document.querySelector("#inputSuperHero");

                        // Evento submit del formulario
                        $('form').on('submit', function(ev) {
                            ev.preventDefault();

                            // Si el número ingresado es menor a 0 ó mayor a 732 oculta las secciones
                            if (numeroDelSuperHero.value <= 0 || numeroDelSuperHero.value > 732) {
                                alert("Debes introducir un valor entre 1 y 732");
                                $("#cardImage").hide();
                                $("#cardInfo").hide();
                                $("#encontrado").hide();
                                $("#chartContainer").hide();
                            } else {

                                $.get(`https://www.superheroapi.com/api.php/3525635500807579/${numeroDelSuperHero.value}`, function(datos) {


                                    if (`${numeroDelSuperHero.value}` <= 0) {
                                        $("#encontrado").text("");
                                        $("#encontrado").hide();

                                        $("#chartContainer").hide();

                                        $("#cardImage").hide();
                                        $("#cardInfo").hide();

                                    } else {
                                        $("#encontrado").text("SuperHero Encontrado")
                                        $("#encontrado").show();

                                        $(".creaGrafico").attr("id", "chartContainer");
                                        $("#chartContainer").show();

                                        $("#cardImage").show();
                                        $("#cardInfo").show();

                                    }


                                    // agrega información a la tarjeta con los datos del superHeroe
                                    $("#spanNombre").html(datos.name);
                                    $("#spanConexiones").html(datos.connections.relatives);
                                    $("#spanPublicacion").html(datos.biography.publisher);
                                    $("#spanOcupacion").html(datos.work.occupation);
                                    $("#spanPrimeraAparicion").html(datos.biography['first-appearance']);
                                    $("#spanAltura").html(`${datos.appearance.height}`);
                                    $("#spanPeso").html(`${datos.appearance.weight}`);
                                    $("#spanAlianzas").html(`${datos.biography.aliases}`);
                                    $("#imagenSuperHeroe").attr("src", datos.image.url);

                                    let newDataPoints = [];
                                    newDataPoints.push({
                                        label: "intelligence",
                                        y: datos.powerstats.intelligence
                                    });

                                    newDataPoints.push({
                                        label: "strength",
                                        y: datos.powerstats.strength
                                    });

                                    newDataPoints.push({
                                        label: "speed",
                                        y: datos.powerstats.speed
                                    });

                                    newDataPoints.push({
                                        label: "durability",
                                        y: datos.powerstats.durability
                                    });

                                    newDataPoints.push({
                                        label: "power",
                                        y: datos.powerstats.power
                                    });
                                    newDataPoints.push({
                                        label: "combat",
                                        y: datos.powerstats.combat
                                    });

                                    options.data[0].dataPoints = newDataPoints;


                                    // Pinta el nombre del superHeroe en el titulo del grafico
                                    options.title.text = `Estadisticas de poder para ${datos.name}`;

                                    $("#chartContainer").CanvasJSChart(options);

                                });
                            }
                        });
                    </script>
                </div>
            </div>
        </div>
    </div>
</body>

</html>